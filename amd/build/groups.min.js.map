{"version":3,"file":"groups.min.js","sources":["../src/groups.js"],"sourcesContent":["\r\ndefine(['jquery', 'core/str', 'core/modal_factory', 'core/modal_events',\r\n    'core/fragment', 'core/templates', 'core/ajax', 'core/notification'],\r\nfunction($, Str, Modal, ModalEvents, Fragment, Templates, AJAX, Notification) {\r\n\r\n    return {\r\n        init: function(contextID) {\r\n\r\n            var groupModal = document.getElementsByClassName('group-widget-viewmembers');\r\n            Array.from(groupModal).forEach(function(element) {\r\n                element.addEventListener('click', function(e) {\r\n                    e.preventDefault();\r\n                    var target = e.target;\r\n                    var group = target.getAttribute('data-group');\r\n                    Modal.create({\r\n                        title: Str.get_string('groups', 'core')\r\n                    }).then(function(modal) {\r\n                        modal.show();\r\n                        var args = JSON.stringify({group: group});\r\n                        var params = {widget: 'groups', method: 'viewmembers', args: args};\r\n                        Fragment.loadFragment('block_dash', 'loadwidget', contextID, params).then((html, js) => {\r\n                            modal.setBody(html);\r\n                            Templates.runTemplateJS(js);\r\n                            return html;\r\n                        }).catch(Notification.exception);\r\n                        modal.getRoot().on(ModalEvents.hidden, function() {\r\n                            modal.destroy();\r\n                        });\r\n                        return modal;\r\n                    }).catch(Notification.exception);\r\n                });\r\n            });\r\n\r\n            var groupUsers = document.getElementsByClassName('add-group-users');\r\n            Array.from(groupUsers).forEach(function(element) {\r\n                element.addEventListener('click', function(e) {\r\n                    e.preventDefault();\r\n                    addGroupUsers(e);\r\n                });\r\n            });\r\n\r\n            /**\r\n             * Modal create for add member to groups menu.\r\n             * @param {Event} e\r\n             */\r\n            function addGroupUsers(e) {\r\n                var target = e.target;\r\n                var group = target.getAttribute('data-group');\r\n                Modal.create({\r\n                    type: Modal.types.SAVE_CANCEL,\r\n                    title: Str.get_string('widget:groups:adduser', 'block_dash'),\r\n                }).then(function(modal) {\r\n                    modal.setLarge(true);\r\n                    modal.show();\r\n\r\n                    var args = JSON.stringify({group: group});\r\n                    var params = {widget: 'groups', method: 'addmembers', args: args};\r\n                    Fragment.loadFragment('block_dash', 'loadwidget', contextID, params).then((html, js) => {\r\n                        modal.setBody(html);\r\n                        modal.getRoot().get(0).querySelectorAll('form').forEach(form => {\r\n                            groupAddEventListeners(form);\r\n                        });\r\n\r\n                        Templates.runTemplateJS(js);\r\n                        return html;\r\n                    }).catch(Notification.exception);\r\n\r\n                    modal.getRoot().on(ModalEvents.hidden, function() {\r\n                        modal.destroy();\r\n                    });\r\n\r\n                    // Apply and save method.\r\n                    modal.getRoot().on(ModalEvents.save, (e) => {\r\n                        e.preventDefault();\r\n                        modal.getRoot().get(0).querySelectorAll('form').forEach(form => {\r\n                            form.querySelector('#id_submitbutton').click();\r\n                        });\r\n                    });\r\n                    return modal;\r\n                }).catch(Notification.exception);\r\n            }\r\n\r\n            /**\r\n             * Event listener for add memebers to groups form submit.\r\n             * @param {Array} form\r\n             */\r\n            function groupAddEventListeners(form) {\r\n                form.addEventListener('submit', function(e) {\r\n                    e.preventDefault();\r\n                    var formdata = new FormData(e.target);\r\n                    if (e.target.querySelector('[name=\"users[]\"]').value == '') {\r\n                        return false;\r\n                    }\r\n                    var formdatastr = new URLSearchParams(formdata).toString();\r\n                    var promises = AJAX.call([{\r\n                        methodname: 'block_dash_groups_add_members',\r\n                        args: {formdata: formdatastr}\r\n                    }]);\r\n\r\n                    promises[0].done((response) => {\r\n                        if (response == true) {\r\n                            window.location.reload();\r\n                        } else {\r\n                            // TODO: Error Notification.\r\n                        }\r\n                    });\r\n                    return true;\r\n                });\r\n            }\r\n\r\n            // Leave group.\r\n            var leaveGroupModal = document.getElementsByClassName('group-widget-leavegroup');\r\n            Array.from(leaveGroupModal).forEach(function(element) {\r\n                element.addEventListener('click', function(e) {\r\n                    e.preventDefault();\r\n                    leaveGroup(e);\r\n                });\r\n            });\r\n\r\n            /**\r\n             * Event observer for leave group menu clicked to trigger the confirmation modal.\r\n             * @param {event} e\r\n             */\r\n            function leaveGroup(e) {\r\n                var target = e.target;\r\n                var group = target.getAttribute('data-group');\r\n                var groupname = target.getAttribute('data-groupname');\r\n\r\n                Modal.create({\r\n                    type: Modal.types.SAVE_CANCEL,\r\n                    title: Str.get_string('groups', 'core'),\r\n                }).then(function(modal) {\r\n                    Str.get_string('confirm', 'core').then((html) => {\r\n                        modal.setSaveButtonText(html);\r\n                        return html;\r\n                    }).catch(Notification.exception);\r\n                    modal.show();\r\n\r\n                    Str.get_string('confirmleavegroup', 'block_dash', groupname).then((html) => {\r\n                        modal.setBody(html);\r\n                        return html;\r\n                    }).catch(Notification.exception);\r\n\r\n                    modal.getRoot().on(ModalEvents.save, (e) => {\r\n                        e.preventDefault();\r\n                        var promises = AJAX.call([{\r\n                            methodname: 'block_dash_groups_leave_group',\r\n                            args: {groupid: group}\r\n                        }]);\r\n\r\n                        promises[0].done((response) => {\r\n                            if (response == true) {\r\n                                window.location.reload();\r\n                            } else {\r\n                                // TODO: Error Notification.\r\n                            }\r\n                        });\r\n                    });\r\n\r\n                    modal.getRoot().on(ModalEvents.hidden, function() {\r\n                        modal.destroy();\r\n                    });\r\n\r\n                    modal.getRoot().on(ModalEvents.destroyed, function() {\r\n                        modal.remove();\r\n                        modal.attachmentPoint.remove();\r\n                    });\r\n                    return modal;\r\n                }).catch(Notification.exception);\r\n            }\r\n\r\n            // Create group.\r\n            var createGroupModal = document.getElementsByClassName('create-group');\r\n            Array.from(createGroupModal).forEach(function(element) {\r\n                element.addEventListener('click', function(e) {\r\n                    e.preventDefault();\r\n                    createGroup();\r\n                });\r\n            });\r\n\r\n            /**\r\n             * Event listner for create group modal trigger.\r\n             */\r\n            function createGroup() {\r\n\r\n                Modal.create({\r\n                    type: Modal.types.SAVE_CANCEL,\r\n                    title: Str.get_string('groups', 'core'),\r\n                }).then(function(modal) {\r\n                    modal.show();\r\n\r\n                    var args = \"\";\r\n                    var params = {widget: 'groups', method: 'creategroup', args: args};\r\n                    Fragment.loadFragment('block_dash', 'loadwidget', contextID, params).then((html, js) => {\r\n                        modal.setBody(html);\r\n                        Templates.runTemplateJS(js);\r\n                        modal.getRoot().get(0).querySelectorAll('form').forEach(form => {\r\n                            createGroupEvent(form);\r\n                        });\r\n                        return html;\r\n                    }).catch(Notification.exception);\r\n\r\n                    // Apply and save method.\r\n                    modal.getRoot().on(ModalEvents.save, (e) => {\r\n                        e.preventDefault();\r\n                        modal.getRoot().get(0).querySelectorAll('form').forEach(form => {\r\n                            form.querySelector('#id_submitbutton').click();\r\n                        });\r\n                    });\r\n\r\n                    modal.getRoot().on(ModalEvents.hidden, function() {\r\n                        modal.destroy();\r\n                    });\r\n                    return modal;\r\n                }).catch(Notification.exception);\r\n\r\n\r\n            }\r\n            /**\r\n             * Event listner for create group forms in modal to init the group creation.\r\n             * @param {Array} form\r\n             */\r\n            function createGroupEvent(form) {\r\n                form.addEventListener('submit', function(e) {\r\n                    e.preventDefault();\r\n                    var formdata = new FormData(e.target);\r\n                    if (e.target.querySelector('[name=\"name\"]').value == \"\"\r\n                        || e.target.querySelector('[name=\"courseid\"]').value == '') {\r\n                        return false;\r\n                    }\r\n                    var formdatastr = new URLSearchParams(formdata).toString();\r\n                    var promises = AJAX.call([{\r\n                        methodname: 'block_dash_groups_create_group',\r\n                        args: {formdata: formdatastr}\r\n                    }]);\r\n\r\n                    promises[0].done((response) => {\r\n                        return (response == true) ? window.location.reload() : '';\r\n                    });\r\n                    return true;\r\n                });\r\n            }\r\n        }\r\n    };\r\n});\r\n"],"names":["define","$","Str","Modal","ModalEvents","Fragment","Templates","AJAX","Notification","init","contextID","groupModal","document","getElementsByClassName","Array","from","forEach","element","addEventListener","e","preventDefault","group","target","getAttribute","create","title","get_string","then","modal","show","params","widget","method","args","JSON","stringify","loadFragment","html","js","setBody","runTemplateJS","catch","exception","getRoot","on","hidden","destroy","groupUsers","type","types","SAVE_CANCEL","setLarge","get","querySelectorAll","form","formdata","FormData","querySelector","value","formdatastr","URLSearchParams","toString","call","methodname","done","response","window","location","reload","groupAddEventListeners","save","click","addGroupUsers","leaveGroupModal","groupname","setSaveButtonText","groupid","destroyed","remove","attachmentPoint","leaveGroup","createGroupModal","createGroupEvent"],"mappings":"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"}